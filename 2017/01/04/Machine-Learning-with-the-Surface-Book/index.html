<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>TensorFlow with the Surface Book | apnorton | blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="While interning at Microsoft over the summer, I received a first-generation Surface Book with an i5-6300U CPU (2.4 GHz dual core with up to 3.0 GHz), 8GB RAM, and a “GeForce GPU” (officially unnamed,">
<meta property="og:type" content="article">
<meta property="og:title" content="TensorFlow with the Surface Book">
<meta property="og:url" content="http://www.apnorton.com/blog/2017/01/04/Machine-Learning-with-the-Surface-Book/index.html">
<meta property="og:site_name" content="apnorton | blog">
<meta property="og:description" content="While interning at Microsoft over the summer, I received a first-generation Surface Book with an i5-6300U CPU (2.4 GHz dual core with up to 3.0 GHz), 8GB RAM, and a “GeForce GPU” (officially unnamed,">
<meta property="og:updated_time" content="2017-01-04T20:34:28.087Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TensorFlow with the Surface Book">
<meta name="twitter:description" content="While interning at Microsoft over the summer, I received a first-generation Surface Book with an i5-6300U CPU (2.4 GHz dual core with up to 3.0 GHz), 8GB RAM, and a “GeForce GPU” (officially unnamed,">
<meta name="twitter:creator" content="@_apnorton">
  
    <link rel="alternative" href="/blog/atom.xml" title="apnorton | blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/blog/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63901553-2', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">apnorton | blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Blog</a>
        
          <a class="main-nav-link" href="http://www.apnorton.com/">Web Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.apnorton.com/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Machine-Learning-with-the-Surface-Book" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2017/01/04/Machine-Learning-with-the-Surface-Book/" class="article-date">
  <time datetime="2017-01-04T20:32:45.000Z" itemprop="datePublished">2017-01-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/computer-science/">computer-science</a>►<a class="article-category-link" href="/blog/categories/computer-science/tools/">tools</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      TensorFlow with the Surface Book
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>While interning at Microsoft over the summer, I received a first-generation Surface Book with an i5-6300U CPU (2.4 GHz dual core with up to 3.0 GHz), 8GB RAM, and a “GeForce GPU” (officially unnamed, but believed to be equivalent to a GT 940).  This is a huge step up from my older laptop, so I wanted to set it up for my ML work.  In this post, I’ll outline how I set it up with TensorFlow and GPU acceleration.</p>
<h2 id="CUDA-cuDNN"><a href="#CUDA-cuDNN" class="headerlink" title="CUDA + cuDNN"></a>CUDA + cuDNN</h2><p>If you want to use GPU acceleration, the typical way to do so is with NVIDIA’s CUDA API.  CUDA 8.0 is compatible with the Surface Book and is (as of this writing) the most up-to-date version of CUDA.  Download it <a href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="external">from the NVIDIA website</a> and run their installer.</p>
<p>For work with deep learning, you’ll also want to install cuDNN.  To install, just <a href="https://developer.nvidia.com/cudnn" target="_blank" rel="external">download</a> the library from NVIDIA’s website and unzip it in a convenient place (I chose <code>C:\cudnn</code>).  The only “installation” you need to do is to add <code>C:\cudnn\bin</code> to your <code>PATH</code> environment variable.</p>
<a id="more"></a>
<h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p>GPU acceleration is where you’re going to get the best performance improvements when running TensorFlow.  However, we might as well set up Python in a way that will run as fast as we can.  </p>
<p>I installed the <a href="https://software.intel.com/intel-distribution-for-python" target="_blank" rel="external"><em>Intel Distribution for Python</em></a>.  This is a clone of Python 3.5, but compiled with optimizations for Intel CPUs and packaged with optimized versions of common libraries like <code>sklearn</code>, <code>pandas</code>, <code>numpy</code>, and more.  It’s a free download from Intel, but it is officially still in Beta.  Thus far, I haven’t run into any problems using it with TensorFlow (but will update this post if I do).</p>
<p>To install Intel Python, just download and run the installer; I installed this to <code>C:\IntelPython35</code>.  If you install it in this location, add <code>C:\IntelPython35\</code> and <code>C:\IntelPython35\Scripts</code> to your <code>PATH</code> environment variable.  (Adding <code>\Scripts</code> to your path allows you to use <code>pip</code> or <code>jupyter</code> directly from the commandline.)</p>
<p>If you decide to use a different installation of Python, make sure you’re installing Python 3.5 and not the recent release of Python 3.6; as of this writing, installing TensorFlow on Windows with Python 3.6 and above is <a href="https://github.com/tensorflow/tensorflow/issues/6533" target="_blank" rel="external">not supported</a>. </p>
<h2 id="TensorFlow"><a href="#TensorFlow" class="headerlink" title="TensorFlow"></a>TensorFlow</h2><p>My understanding is that compiling TensorFlow from source using Intel’s <code>icc</code> and BLAS/LAPACK libraries will give you the best performance, but I  don’t have a permanent license to these, and so just installed with <code>pip</code>.</p>
<p>The version of <code>pip</code> included with Intel Python is quite old, so the first step here is to upgrade it using <code>python -m pip install --upgrade pip</code>.  Following this, we need to download the TensorFlow wheel from Google.  The up-to-date link can be found <a href="https://www.tensorflow.org/get_started/os_setup#pip_installation_on_windows" target="_blank" rel="external">here</a>, but the current link is for <a href="https://storage.googleapis.com/tensorflow/windows/gpu/tensorflow_gpu-0.12.1-cp35-cp35m-win_amd64.whl" target="_blank" rel="external">v0.12.1 with GPU support</a>.  (I found that downloading the wheel has better success than running <code>pip</code> directly on the URL.)</p>
<p>Finally, execute <code>pip install --upgrade [TF-downloaded-file]</code> to install TensorFlow.  This should finish somewhat quickly, and then you are done!</p>
<p>When I first installed TensorFlow, I had some issues with an existing <code>setuptools</code> installation and was getting an error similar to:</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Installing collected packages: six, setuptools, protobuf, numpy, tensorflow</span><br><span class="line">  Found existing installation: setuptools 19.1.1</span><br><span class="line">  <span class="keyword">*</span><span class="keyword">*</span>Cannot remove entries from nonexistent file C:\IntelPython35\Lib\site-packages\easy-install.pth<span class="keyword">*</span><span class="keyword">*</span></span><br></pre></td></tr></table></figure>
<p>This was <a href="https://github.com/tensorflow/tensorflow/issues/622" target="_blank" rel="external">raised as an issue</a> (<a href="https://github.com/tensorflow/tensorflow/issues/135" target="_blank" rel="external">and another issue</a>) on the TensorFlow GitHub.  The solution that worked for me was to run the following:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span> -I <span class="comment">--upgrade setuptools</span></span><br><span class="line">pip <span class="keyword">install</span> <span class="comment">--upgrade [TF-downloaded-file]</span></span><br></pre></td></tr></table></figure>
<h2 id="Testing-the-Installation"><a href="#Testing-the-Installation" class="headerlink" title="Testing the Installation"></a>Testing the Installation</h2><p>Open up your terminal, and we’ll run a few commands: </p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ python</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; import tensorflow as tf</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; a = tf.constant(<span class="number">12</span>)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; b = tf.constant(<span class="number">30</span>)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; sess = tf.Session()</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; print(sess.run(a+b))</span><br><span class="line"><span class="number">42</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt;</span><br></pre></td></tr></table></figure>
<p>If it printed 42 at the end, then it works!  I recommend taking a look at the <a href="https://www.tensorflow.org/get_started/" target="_blank" rel="external">TensorFlow MNIST tutorials</a> after this, as they introduce TensorFlow’s capabilities quite nicely.</p>
<p>At one point, I had a problem where any call to <code>tf.Session()</code> or <code>tf.InteractiveSession()</code> would cause Python to crash without displaying any error (Windows would display a “This process has stopped responding” dialog box and kill Python after a minute or so).  I never found out <em>why</em> this happened, but restarting my computer resolved the issue and I haven’t experienced it again.</p>
<p>If you’re curious whether your GPU utilized, look at the debug information that was printed after running <code>tf.Session()</code>.  If it includes lines like the below (some unnecessary path names trimmed), then the GPU was used:</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Found device <span class="number">0</span> <span class="keyword">with</span> <span class="attribute">properties</span>:</span><br><span class="line"><span class="attribute">name</span>: GeForce GPU</span><br><span class="line"><span class="attribute">major</span>: <span class="number">5</span></span><br><span class="line"><span class="attribute">minor</span>: <span class="number">0</span></span><br><span class="line">memoryClockRate (GHz) <span class="number">0.993</span></span><br><span class="line">pciBusID <span class="number">0000</span>:<span class="number">01</span>:<span class="number">00.0</span></span><br><span class="line">Total <span class="attribute">memory</span>: <span class="number">1.00</span>GiB</span><br></pre></td></tr></table></figure>
<p><em>Credit where credit is due! When I was performing my install, I was greatly aided by <a href="http://www.heatonresearch.com/2017/01/01/tensorflow-windows-gpu.html" target="_blank" rel="external">this blog post</a> from Heaton Research.</em></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.apnorton.com/blog/blog/2017/01/04/Machine-Learning-with-the-Surface-Book/" data-id="cizqfw6xo000v7xgcwsggglfv" class="article-share-link">Share</a>
      
        <a href="http://www.apnorton.com/blog/blog/2017/01/04/Machine-Learning-with-the-Surface-Book/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/computer-science/">computer-science</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/data/">data</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2017/02/28/How-I-wrote-a-Groupme-Chatbot-in-24-hours/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          How I wrote a GroupMe Chatbot in 24 hours
        
      </div>
    </a>
  
  
    <a href="/blog/2016/12/19/Visualizing-Multidimensional-Data-in-Python/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Visualizing Multidimensional Data in Python</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2017/02/28/How-I-wrote-a-Groupme-Chatbot-in-24-hours/">How I wrote a GroupMe Chatbot in 24 hours</a>
          </li>
        
          <li>
            <a href="/blog/2017/01/04/Machine-Learning-with-the-Surface-Book/">TensorFlow with the Surface Book</a>
          </li>
        
          <li>
            <a href="/blog/2016/12/19/Visualizing-Multidimensional-Data-in-Python/">Visualizing Multidimensional Data in Python</a>
          </li>
        
          <li>
            <a href="/blog/2016/11/09/Election-2016/">Election 2016: Moving Forward</a>
          </li>
        
          <li>
            <a href="/blog/2016/10/28/Commenting/">New Feature: Commenting!</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/book-reviews/">book-reviews</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/computer-science/">computer-science</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/computer-science/algorithms/">algorithms</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/computer-science/contests/">contests</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/computer-science/programming-languages/">programming-languages</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/computer-science/tools/">tools</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/fun/">fun</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/fun/seattle/">seattle</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/math/">math</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/math/computational-geometry/">computational-geometry</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/math/number-theory/">number-theory</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/meta/">meta</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/opinion/">opinion</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/algorithms/" style="font-size: 15px;">algorithms</a> <a href="/blog/tags/books/" style="font-size: 12.5px;">books</a> <a href="/blog/tags/computer-science/" style="font-size: 17.5px;">computer-science</a> <a href="/blog/tags/contests/" style="font-size: 10px;">contests</a> <a href="/blog/tags/data/" style="font-size: 12.5px;">data</a> <a href="/blog/tags/functional-programming/" style="font-size: 10px;">functional-programming</a> <a href="/blog/tags/general-computing/" style="font-size: 10px;">general-computing</a> <a href="/blog/tags/internship/" style="font-size: 12.5px;">internship</a> <a href="/blog/tags/life/" style="font-size: 12.5px;">life</a> <a href="/blog/tags/math/" style="font-size: 20px;">math</a> <a href="/blog/tags/meta/" style="font-size: 12.5px;">meta</a> <a href="/blog/tags/number-theory/" style="font-size: 10px;">number-theory</a> <a href="/blog/tags/opinion/" style="font-size: 10px;">opinion</a> <a href="/blog/tags/project-euler/" style="font-size: 10px;">project-euler</a> <a href="/blog/tags/websites/" style="font-size: 10px;">websites</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/02/">February 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/12/">December 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/10/">October 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/03/">March 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2014/07/">July 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2014/06/">June 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2014/05/">May 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Andrew Norton<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Blog</a>
  
    <a href="http://www.apnorton.com/" class="mobile-nav-link">Web Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'apnorton';
  
  var disqus_url = 'http://www.apnorton.com/blog/blog/2017/01/04/Machine-Learning-with-the-Surface-Book/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>

  </div>
</body>
</html>